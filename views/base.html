<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns#">
<head>
	{% block head %}
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="theme-color" content="#010101">
	<meta name="robots" content="noindex, nofollow">
	<link title="metasearch" type="application/opensearchdescription+xml" rel="search" href="/opensearch.xml"/>
	<title>{% block title %}Metasearch{% endblock %}</title>
	<style>
:root {
{% if dark %}
	--background-color: #111;
	--title-color: #fff;
	--main-text: #eee;
	--semi-light: rgba(255,255,255,.5);
	--very-light: rgba(255,255,255,.2);
	--very-very-light: rgba(255,255,255,.05);
	--result-content-color: #ccc;
{% else %}
	--background-color: #fff;
	--title-color: #000;
	--main-text: #000;
	--semi-light: #aaa;
	--very-light: #bbb;
	--very-very-light: #eaeaea;
	--result-content-color: #000;
{% endif %}
}
	</style>
	<link rel="stylesheet" href="/styles.css">
	<script>
document.addEventListener('DOMContentLoaded', () => {

const searchFormEl = document.getElementById('search-form')
const searchInputEl = document.getElementById('search-bar')
const dataList = document.createElement('datalist')
searchInputEl.parentNode.insertBefore(dataList, searchInputEl.nextSibling)
dataList.id = 'autocomplete'

async function autoComplete(query) {
	const result = await fetch('/autocomplete?q=' + encodeURIComponent(query))
	return await result.json()
}
async function autoCompleteDataList(query) {
	const results = await autoComplete(query)
	dataList.innerHTML = ''
	for (const result of results) {
		const optionEl = document.createElement('option')
		optionEl.textContent = result
		optionEl.onclick = () => {
			searchInputEl.value = result
			dataList.style.display = 'none'
			searchFormEl.submit()
		}
		dataList.appendChild(optionEl)
	}

	if (dataList.options.length > 0) {
		dataList.style.display = 'block'
		dataList.style.width = (searchInputEl.offsetWidth - 2) + 'px'
		dataList.style.left = searchInputEl.offsetLeft + 'px'
		searchInputEl.style.borderBottom = 'none'
		searchInputEl.style.borderBottomLeftRadius = '0'
		searchInputEl.style.borderBottomRightRadius = '0'
	} else {
		dataList.style.display = 'none';
		searchInputEl.style.borderBottom = ''
		searchInputEl.style.borderBottomLeftRadius = ''
		searchInputEl.style.borderBottomRightRadius = ''

	}
}
searchInputEl.addEventListener('input', (e) => {
	autoCompleteDataList(e.target.value)
})

searchInputEl.onfocus = function () {
	if (dataList.options.length > 0) {
		dataList.style.display = 'block';
		searchInputEl.style.borderBottom = 'none'
		searchInputEl.style.borderBottomLeftRadius = '0'
		searchInputEl.style.borderBottomRightRadius = '0'
	}
}
searchInputEl.onblur = function () {
	setTimeout(() => {
		dataList.style.display = 'none';
		searchInputEl.style.borderBottom = ''
		searchInputEl.style.borderBottomLeftRadius = ''
		searchInputEl.style.borderBottomRightRadius = ''
	}, 100)
}
window.addEventListener('resize', () => {
	dataList.style.width = (searchInputEl.offsetWidth - 2) + 'px';
	dataList.style.left = searchInputEl.offsetLeft + 'px';
})
})
	</script>
	{% endblock %}
</head>
<body>
	{% block body %}{% endblock %}
</body>
</html>